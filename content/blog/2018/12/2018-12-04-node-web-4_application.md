---
title: "[Node.jsì½”ë“œë©] 4.ì–´í”Œë¦¬ì¼€ì´ì…˜"
layout: post
summary: ì–´í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë“ˆì„ ë§Œë“­ë‹ˆë‹¤.
category: series
seriesId: "555b6438-4a71-51d0-9156-a1d5ca4d5eab"
tags: [lecture]
---

## ğŸŒ³ëª©í‘œ

ìš°ë¦¬ê°€ ë§Œë“¤ì—ˆë˜ server.jsëŠ” http ëª¨ë“ˆì„ ì§ì ‘ ê°€ì ¸ë‹¤ ì‚¬ìš©í•œ ê²ƒì…ë‹ˆë‹¤.
ëª¨ë“ˆì˜ createServer() í•¨ìˆ˜ì™€ listen() í•¨ìˆ˜ë¥¼ ì§ì ‘ ì‚¬ìš©í–ˆì£ .

ì™¸ë¶€ ëª¨ë“ˆ í˜¹ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë”°ìœ„ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” í•œ ë²ˆ ë˜í•‘í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
ìš°ë¦¬ ì½”ë“œê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ê°•í•˜ê²Œ ì»¤í”Œë§ ë˜ì§€ ì•Šë„ë¡ í•˜ëŠ”ê²ƒì´ì£ .
í•œ ë‹¨ê³„ ë²„í¼ë¥¼ ë‘¬ì„œ ì™¸ë¶€ ì½”ë“œì˜ ë³€í™”ì— ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•˜ê¸° ìœ„í•©ë‹ˆë‹¤.

## Application ëª¨ë“ˆ

ê·¸ë˜ì„œ "Application" ì´ë€ ì´ë¦„ìœ¼ë¡œ ëª¨ë“ˆì„ ë‹¤ì‹œ ë§Œë“¤ì–´ ë³¼ê±°ì—ìš”.
ì´ ëª¨ë“ˆì€ httpë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•  ê²ƒì´ê³ ìš”.

ë¨¼ì € ì§€ë‚œ ì‹œê°„ê¹Œì§€ í–ˆë˜ ì½”ë“œë¡œ ì´ë™í•˜ê² ìŠµë‹ˆë‹¤.

```
$ git checkout -f application/listen-spec
```

ì¶”ê°€ ëª¨ë“ˆ(sinon)ì´ ìˆê¸° ë•Œë¬¸ì— package.jsonì— ê¸°ë¡í•œ ëª¨ë“ˆì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```
$ npm install
```

src í´ë”ì— Application.spec.js íŒŒì¼ë¶€í„° ì‚´í´ ë³´ê² ìŠµë‹ˆë‹¤.
ìš°ë¦¬ê°€ ë§Œë“¤ Application ëª¨ë“ˆì˜ ìš”êµ¬ì‚¬í•­ì„ í…ŒìŠ¤í¬ ì½”ë“œë¡œ ì‘ì„±í•´ ë‘” ê²ƒì´ì£ .

ë„¤ ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆ ì„œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

```js
describe('Application', () => {
  describe('listen()', () => {
    it('server ê°ì²´ì˜ listen í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤', () => {
```

ì´ì „ ê¸€ì—ì„œ ëª¨ì¹´ë¥¼ ì†Œê°œí–ˆì—ˆì£ ? ëª¨ì¹´ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•´ì£¼ëŠ” í…ŒìŠ¤íŠ¸ ëŸ¬ë„ˆì…ë‹ˆë‹¤.
ëª¨ì¹´ í”„ë ˆì„ì›ì´ ì œê³µí•˜ëŠ” API í•¨ìˆ˜ê°€ ëª‡ ê°œìˆëŠ”ë°ìš”, ì €ëŠ” `describe()`ê³¼ `it()`ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

- `descirbe()`: í…ŒìŠ¤íŠ¸ ê¾¸ëŸ¬ë¯¸(Test Suite)ë¼ê³  í•˜ë©° í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ê¸°ìˆ í•¨
- `it()`: í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤(Test Case)ë¼ê³  í•˜ë©° ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì •ì˜í•¨

ìœ„ ì½”ë“œëŠ” "Application ëª¨ë“ˆì˜ listen() ë©”ì†Œë“œë¥¼ í…ŒìŠ¤íŠ¸" í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.
ì´ ë©”ì†Œë“œëŠ” "server ê°ì²´ì˜ listen í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤"ë¼ëŠ” í…ŒìŠ¤íŠ¸ì¸ ê²ƒì´ì£ .

```js
// arrange
const app = App() // const App = require('./Application') ìœ¼ë¡œ ê°€ì ¸ì™”ë‹¤ê³  ê°€ì •
const spy = sinon.spy()
app._server.listen = spy
```

ìœ ë‹› í…ŒìŠ¤íŠ¸ëŠ” ë³´í†µ ì„¸ ë‹¨ê³„ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤.

- ì¤€ë¹„(arragne) -> ì‹¤í–‰(act) -> ê²€ì¦(assert)

ìœ„ ì½”ë“œëŠ” ì²« ë²ˆì§¸ ì¤€ë¹„ ë‹¨ê³„ë¥¼ ì •ì˜í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.
ì–´í”Œë¦¬ì¼€ì´ì…˜ ê°ì²´ì™€ ìŠ¤íŒŒì´ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  app.\_server ê°ì²´ì˜ listen ì†ì„±ì— ìŠ¤íŒŒì´ë¥¼ ì‹¬ì–´ ë‘ì—ˆì£ .
ìŠ¤íŒŒì´ë¥¼ ì‹¬ì€ ì´ìœ ëŠ” ê²€ì¦í• ë•Œ listen í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì—ˆì§€ëŠ” ìŠ¤íŒŒì´ë¡œ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ ì…ë‹ˆë‹¤.

```js
// act
app.listen()
```

ì‹¤ì œ í…ŒìŠ¤íŠ¸ í•´ì•¼í•  ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```js
// assert
should(spy.called).be.equal(true)
```

listen ë©”ì†Œë“œê°€ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ ìŠ¤íŒŒì´ë¥¼ í†µí•´ ê²€ì‚¬í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.

í…ŒìŠ¤íŠ¸ë¥¼ ëŒë ¤ ë³¼ê¹Œìš”?

```
$ npm t

Error: Cannot find module './Application'
```

ì´ê²ƒë³´ë‹¤ ë§ì€ ë©”ì„¸ì§€ê°€ ë‚˜ì˜¤ì§€ë§Œ Application ëª¨ë“ˆì„ ì°¾ì§€ ëª»í•˜ëŠ”ê²Œ í•µì‹¬ì…ë‹ˆë‹¤.
ì™œëƒë©´ ìš°ë¦¬ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë§Œ ë§Œë“¤ì—ˆì§€ ëŒ€ìƒì´ ë˜ëŠ” Application.js ëŠ” ë§Œë“¤ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ì£ .

## ğŸ¤ì‹¤ìŠµ - Application ëª¨ë“ˆê³¼ listen ë©”ì†Œë“œ êµ¬í˜„

Application ëª¨ë“ˆì„ êµ¬í˜„í•´ ë³´ì„¸ìš”. Applicationì€ listen ë©”ì†Œë“œë¥¼ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤.
êµ¬í˜„í•œ ë’¤ì—ëŠ” ë°˜ë“œì‹œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ í†µê³¼í•´ì•¼ í•˜êµ¬ìš”.

## ğŸ¤í’€ì´

ì ê·¸ëŸ¼ ê°™ì´ í’€ì–´ ë³¼ê¹Œìš”? ì„¸ ë‹¨ê³„ë¡œ ë‚˜ëˆ  ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

```js
const http = require("http")

const Application = () => {
  const listen = () => {}

  return {
    listen,
  }
}

module.exports = Application
```

ë¨¼ì € http ëª¨ë“ˆì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³  ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ëª¨ë“ˆ íŒ¨í„´ìœ¼ë¡œ Applicationì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
ëª¨ë“ˆ íŒ¨í„´ì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ”ë°ìš”,
í…ŒìŠ¤íŠ¸ ì½”ë“œì— ìˆëŠ” listen í•¨ìˆ˜ë¥¼ ë„£ì–´ì„œ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤. ì•„ì§ ì´ê±´ ë¹ˆ í•¨ìˆ˜ì´ê³ ìš”.
ë§ˆì§€ë§‰ ì¤„ì— Applicationì„ ëª¨ë“ˆë¡œ ë§Œë“¤ì–´ì„œ ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.

```js
const _server = http.createServer((req, res) => {
  res.statusCode = 200
  res.setHeader("Content-Type", "text/plain")
  res.end("Hello World\n")
})

// ...

return {
  _server,
  listen,
}
```

í…ŒìŠ¤íŠ¸ ì½”ë“œì— ë³´ë©´ _server ê°ì²´ë¥¼ í†µí•´ ìŠ¤íŒŒì´ë¥¼ ì‹¬ì–´ë‘ê³  ìˆì£ .
ì´ê±´ í…ŒìŠ¤íŠ¸ ìš©ë„ë¡œ ë…¸ì¶œí•˜ëŠ” ê²ƒì´ë¼ ë³€ìˆ˜ ì´ë¦„ ì•ì— ì–¸ë”ìŠ¤ì½”ì–´(`_`)ë¥¼ ë¶™ì˜€ìŠµë‹ˆë‹¤.
http.createServer() í•¨ìˆ˜ë¡œ ì„œë²„ë¥¼ ë§Œë“¤ì–´ \_serverì— ì €ì¥í–ˆê³  ì™¸ë¶€ë¡œ ë…¸ì¶œí•˜ì˜€ìŠµë‹ˆë‹¤.

```js
const listen = (port = 3000, hostname = "127.0.0.1", fn) => {
  _server.listen(port, hostname, fn)
}
```

ìƒì„±í•œ \_server ê°ì²´ë¥¼ í†µí•´ listen í•¨ìˆ˜ ì½”ë“œë¥¼ ì±„ì›Œ ë„£ì—ˆìŠµë‹ˆë‹¤.
í¬íŠ¸ ë²ˆí˜¸ì™€ í˜¸ìŠ¤íŠ¸ëª… ê¸°ë³¸ ì¸ìê°’ì„ ì„¤ì •í•´ì„œ ë°©ì–´ ì½”ë“œë¥¼ ë§Œë“¤ì—ˆêµ¬ìš”.
í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ listen í•¨ìˆ˜ í˜¸ì¶œì—¬ë¶€ë¥¼ ì²´í¬í–ˆê¸° ë•Œë¬¸ì— \_server.listen()ì„ í˜¸ì¶œí–ˆìŠµë‹ˆë‹¤.

ì´ì œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•´ ë³¼ê¹Œìš”?

```
$ npm test

  Application
    listen()
      âœ“ server ê°ì²´ì˜ listen í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤

  1 passing (8ms)
```

ì„±ê³µì ìœ¼ë¡œ í†µê³¼í–ˆë„¤ìš”.

server.jsë¥¼ app.jsë¡œ ì´ë¦„ì„ ë°”ê¾¸ê² ìŠµë‹ˆë‹¤.
ì´ì œëŠ” ì„œë²„ë¼ê¸°ë³´ë‹¤ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë“ˆì„ ì´ìš©í•œ ì–´í”Œë¦¬ì¼€ì´ì…˜ ê°ì²´ë¼ëŠ” ì˜ë¯¸ì£ .
app.js ì½”ë“œë¥¼ ë³¼ê¹Œìš”?

```js
const App = require("./src/Application")
const app = App()

module.exports = app
```

Application ëª¨ë“ˆì„ ê°€ì ¸ì™€ ê°ì²´ë¥¼ ë§Œë“¤ì–´ appì— ì €ì¥í–ˆì£ . ê³§ì¥ ëª¨ë“ˆë¡œ ë…¸ì¶œí–ˆìŠµë‹ˆë‹¤.

bin.jsë„ ë³¼ê¹Œìš”?

```js
const app = require("./app")
const hostname = "127.0.0.1"
const port = 3000

app.listen(port, hostname, () => {
  console.log(`Server running at http://${hostname}:${port}/`)
})
```

"server" ëŒ€ì‹  "app" ëª¨ë“ˆì„ ê°€ì ¸ì˜¨ ê²ƒë§Œ ë‹¬ë¼ì¡ŒìŠµë‹ˆë‹¤.

ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë©´ ì˜ ë™ì‘í•˜ë„¤ìš”.

```
npm start

Server running at http://127.0.0.1:3000/
```

Application ëª¨ë“ˆì€ ì•„ë˜ ì´ˆë¡ìƒ‰ ë¶€ë¶„ì…ë‹ˆë‹¤.
ë“œë””ì–´ ìµìŠ¤í”„ë ˆìŠ¤JSì˜ ì²«ë²ˆì§¸ ëª¨ë“ˆì„ ë§Œë“¤ì—ˆêµ°ìš”.

![](/assets/imgs/2018/12/04/struct.png)

## ì •ë¦¬

- httpë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•Šê³  Application ê°ì²´ë¡œ ì¶”ìƒí™” í•˜ì˜€ìŠµë‹ˆë‹¤.

[ëª©ì°¨ ë°”ë¡œê°€ê¸°](/series/2018/12/01/node-web-0_index.html)
