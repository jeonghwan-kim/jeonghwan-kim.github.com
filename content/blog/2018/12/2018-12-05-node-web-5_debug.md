---
slug: "/series/2018/12/05/node-web-5_debug.html"
date: 2018-12-05
title: "[Node.jsì½”ë“œë©] 5.ì»¤ìŠ¤í…€ ëª¨ë“ˆ Debug"
layout: post
seriesId: series-2018-12-01-weplanet-codelab
category: ì—°ì¬ë¬¼
---

## ğŸŒ³ëª©í‘œ

ë…¸ë“œì—ì„œ ê½¤ ë§ì´ ì‚¬ìš©ë˜ëŠ” debug ëª¨ë“ˆì„ ì§ì ‘ ë§Œë“¤ì–´ ë´…ë‹ˆë‹¤.

## Debugë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

[Debug](https://github.com/visionmedia/debug) ëª¨ë“ˆì€ ë…¸ë“œì—ì„œ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” ë””ë²„ê¹… ëª¨ë“ˆì…ë‹ˆë‹¤.
ë¡œê·¸ë¥¼ êµ¬ì¡°ì ìœ¼ë¡œ ê¸°ë¡í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì—ì„œ console.log ë³´ë‹¤ ë›°ì–´ë‚©ë‹ˆë‹¤.
Debugê°€ ê°–ê³  ìˆëŠ” ì¥ì ì€ ì•„ë˜ ë‘ ê°€ì§€ì…ë‹ˆë‹¤.

- íƒœê·¸ë¥¼ ì§€ì •í•œ ë¡œê·¸ í•¨ìˆ˜ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤
- íƒœê·¸ë³„ë¡œ ìƒ‰ìƒì„ ì¤˜ì„œ ë¡œê·¸ ì‹ë³„ì´ ìˆ˜ì›”í•˜ë‹¤

ì‚¬ìš© ë°©ë²•ì€ ì•„ë˜ì²˜ëŸ¼ ê°„ë‹¨í•©ë‹ˆë‹¤.

```js
const debug = require("debug")("my_tag")
debug("my_log") // "my_tag my_log"
```

ì´ê²ƒì„ ì§ì ‘ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.

## í…ŒìŠ¤íŠ¸ ì½”ë“œ

í…ŒìŠ¤íŠ¸ë¥¼ ì½”ë“œê°€ ìˆëŠ” ë¸Œëœì¹˜ë¡œ ì´ë™í•˜ê² ìŠµë‹ˆë‹¤.

```
$ git checkout -f module/debug-spec
```

utils/debug.spec.jsì— ìˆëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‚´í´ ë³´ì§€ìš”.
ë„¤ ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

```js
require('should');
const sinon = require('sinon');
const debug = require('./debug');

describe('debug', () => {
  describe('ìƒì„±', () => {
    it('íƒœê·¸ëª…ì„ ì¸ìë¡œ ë°›ëŠ”ë‹¤ (ì—†ìœ¼ë©´ ì˜ˆì™¸ë¥¼ ë˜ì§„ë‹¤)', () => {
      should(() => debug()).throw();
    })
```

í•„ìš”í•œ ëª¨ë“ˆì„ ê°€ì ¸ì™€ì„œ ìƒìˆ˜ì— í• ë‹¹í–ˆìŠµë‹ˆë‹¤.
debug ëª¨ë“ˆì˜ ìƒì„± ì‹œì ì˜ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ì½”ë“œì¸ë° íƒœê·¸ëª…ì„ ì¸ìë¡œ ë°›ë„ë¡ í•©ë‹ˆë‹¤.
ë§Œì•½ íƒœê·¸ ì¸ìê°€ ì—†ìœ¼ë©´ ì˜ˆì™¸ë¥¼ ë˜ì§€ë„ë¡ í–ˆì£ .

```js
    it('í•¨ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤', () => {
      const debug = require('./debug')('mytag');
      should(typeof debug).be.equal('function');
    })
  })
```

íƒœê·¸ë¥¼ ì „ë‹¬í•œ í•¨ìˆ˜ëŠ” ë‹¤ì‹œ í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ”ì§€ typeofë¡œ ì²´í¬í–ˆìŠµë‹ˆë‹¤.

```js
  describe('ë°˜í™˜ëœ í•¨ìˆ˜', () => {
    let debug, tag, msg;

    beforeEach(() => {
      tag = 'mytag';
      debug = require('./debug')(tag);
      msg = 'my log message';
    })

    it('tag + message í˜•ì‹ì˜ ë¡œê·¸ ë¬¸ìì—´ì„ ë°˜í™˜í•œë‹¤', () => {
      const expected = `${tag} ${msg}`;
      const actual = debug(msg);
      actual.should.be.equal(expected);
    })
```

ì´ê²ƒì€ ë°˜í™˜ëœ í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.

ëª¨ì¹´ í”„ë ˆì„ì›ì—ì„œ ì œê³µí•˜ëŠ” beforeEach() í•¨ìˆ˜ëŠ” í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤(it) ì‹¤í–‰ ì „ë§ˆë‹¤ ë™ì‘í•©ë‹ˆë‹¤.
ë§¤ í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ì—ì„œ debug ê°ì²´ë¥¼ ë§Œë“¤ê¸° ë•Œë¬¸ì— ì¤‘ë³µ ì½”ë“œë¥¼ ì´ê³³ì— ëª¨ì•„ë…¼ ê²ƒì´ì£ .
DRYí•¨ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œë„ ì˜ˆì™¸ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ë°˜í™˜í•œ í•¨ìˆ˜ì— ë©”ì„¸ì§€(msg)ë¥¼ ì „ë‹¬í•´ ì‹¤í–‰í•˜ë©´ tag + msg ë¬¸ìì—´ì´ ë°˜í™˜ë˜ëŠ”ì§€ ì ê²€í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.

```js
  it('ë¡œê·¸ ë¬¸ìì—´ì„ ì¸ìë¡œ console.log í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤', () => {
    sinon.spy(console, 'log');
    const expected = `${tag} ${msg}`;

    debug(msg);

    sinon.assert.calledWith(console.log, expected);
  })
})
```

sinon ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´ì„œ console.log ë©”ì†Œë“œì— ìŠ¤íŒŒì´ë¥¼ ì‹¬ì—ˆìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³  dubug(msg)ë¥¼ ì‹¤í–‰í–ˆì„ ë•Œ ê¸°ëŒ€í•˜ëŠ” ë¬¸ìì—´ì´ console.log í•¨ìˆ˜ ì¸ìë¡œ ì „ë‹¬ë˜ëŠ”ì§€ ì ê²€í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.

## ğŸ¤ì‹¤ìŠµ - debug ëª¨ë“ˆì„ ë§Œë“¤ì–´ ë´…ë‹ˆë‹¤

ìœ„ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ìš”êµ¬í•˜ëŠ” debug ëª¨ë“ˆì„ ë§Œë“¤ì–´ ë³´ì„¸ìš”.

## ğŸ¤í’€ì´

ì˜ í’€ì–´ ë³´ì…¨ë‚˜ìš”?
utils/debug.js íŒŒì¼ì„ ìƒˆë¡œ ë§Œë“¤ì–´ ê°™ì´ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```js
const debug = tag => {
  if (!tag) throw Error("tag should be required")
}

module.exports = debug
```

ë¨¼ì € debugë¥¼ tag ì¸ìë¥¼ ë°›ëŠ” í•¨ìˆ˜ë¡œ ì •ì˜ í–ˆìŠµë‹ˆë‹¤.
ì¸ìê°€ ì—†ìœ¼ë©´ ë°”ë¡œ ì—ëŸ¬ë¥¼ ë˜ì§€ë„ë¡ í•´ì„œ ì²« ë²ˆì§¸ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ í†µê³¼í•˜ë„ë¡ í–ˆêµ¬ìš”.
ë§ˆì§€ë§‰ì—” ì—­ì‹œ ëª¨ë“ˆë¡œ ë…¸ì¶œí•˜ì˜€ìŠµë‹ˆë‹¤.

```js
const debug = tag => {
  // ...
  return msg => {
    const logString = `${tag} ${msg}`;
    console.log(logString);
    return logString;
  }
// ...
```

debug í•¨ìˆ˜ëŠ” ë‹¤ì‹œ í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ë„ë¡ í–ˆì£ . ê·¸ë˜ì„œ msgë¥¼ ì¸ìë¡œ ë°›ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜í–ˆìŠµë‹ˆë‹¤.
ê·¸ëŸ° ë’¤ í´ë¡œì ¸ë¡œ ìº¡ì³ëœ tag ê°’ê³¼ msgë¥¼ ì¡°í•©í•´ì„œ ë¡œê·¸ ë¬¸ìì—´(logString)ì„ ë§Œë“­ë‹ˆë‹¤.
ì´ ê°’ì€ console.logì™€ ë°˜í™˜ ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

ê·¸ëŸ¼ í…ŒìŠ¤íŠ¸ë¥¼ ëŒë ¤ ë³¼ê¹Œìš”?

```
$ npm test

debug
    ìƒì„±
      âœ“ íƒœê·¸ëª…ì„ ì¸ìë¡œ ë°›ëŠ”ë‹¤ (ì—†ìœ¼ë©´ ì˜ˆì™¸ë¥¼ ë˜ì§„ë‹¤)
      âœ“ í•¨ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤
    ë°˜í™˜ëœ í•¨ìˆ˜
      âœ“ tag + message í˜•ì‹ì˜ ë¡œê·¸ ë¬¸ìì—´ì„ ë°˜í™˜í•œë‹¤
      âœ“ ë¡œê·¸ ë¬¸ìì—´ì„ ì¸ìë¡œ console.log í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤
    ë©”ì„¸ì§€ ì¶œë ¥í•¨ìˆ˜
      âœ“ _log() í•¨ìˆ˜ ê²°ê³¼ë¬¸ìì—´ì„ console.log()í•¨ìˆ˜ì˜ ì¸ìë¡œ ì „ë‹¬í•˜ì—¬ ì‹¤í–‰í•œë‹¤
```

ëª¨ë“  í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì— í†µê³¼í–ˆìŠµë‹ˆë‹¤.

## ğŸ¤ì‹¤ìŠµ-ìƒ‰ìƒë„ ì¶”ê°€í•´ ë³´ì„¸ìš”

íƒœí¬ ë¬¸ì ìƒ‰ìƒì„ ëœë¤ìœ¼ë¡œ ì¶œë ¥í•˜ë„ë¡ debug ëª¨ë“ˆì„ ê°œì„ í•´ ë³´ì„¸ìš”.

_íŒíŠ¸: [ìŠ¤íƒì˜¤ë²„í”Œë¡œìš° How to change node.js's console font color](https://stackoverflow.com/questions/9781218/how-to-change-node-jss-console-font-color?answertab=active#tab-top)_

## ğŸ¤í’€ì´

íŒíŠ¸ê°€ ë„ì›€ì´ ë˜ì—ˆë‚˜ìš”? ê·¸ëŸ¼ uitls/debug.jsë¥¼ ê°™ì´ ê°œì„ í•´ ë³´ê² ìŠµë‹ˆë‹¤.

ë¬¸ìì— ìƒ‰ìƒì„ ì¶”ê°€í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤.

```
ë¬¸ìì½”ë“œ + ë¬¸ì + ë¦¬ì…‹ì½”ë“œ
```

ë”°ë¼ì„œ ìš°ë¦¬ ì½”ë“œ ìƒë‹¨ì— ì•„ë˜ì™€ ê°™ì´ ìƒ‰ìƒ ì •ë³´ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```js
const colors = [
  { name: "cyan", value: "\x1b[36m" },
  { name: "yellow", value: "\x1b[33m" },
  { name: "red", value: "\x1b[31m" },
  { name: "green", value: "\x1b[32m" },
  { name: "magenta", value: "\x1b[35m" },
]
const resetColor = "\x1b[0m"
```

íŒíŠ¸ì—ì„œ ì–¸ê¸‰í•œ ê²ƒ ì²˜ëŸ¼ ìƒ‰ìƒ ì½”ë“œë¥¼ ë”•ì…”ë„ˆë¦¬ë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³  resetColorë„ ë”°ë¡œ ìƒìˆ˜ë¡œ ë‘ì—ˆêµ¬ìš”.

```js
const debug = tag => {
  const randIdx = Math.floor(Math.random() * colors.length) % colors.length
  const color = colors[randIdx]
```

íƒœê·¸ ì¸ìë¥¼ ë°›ìë§ˆì íƒœê·¸ì˜ ìƒ‰ìƒì„ ì •í•˜ê¸° ìœ„í•´ colors ë°°ì—´ì—ì„œ ëœë¤ìœ¼ë¡œ ì¸ë±ìŠ¤ë¥¼ êµ¬í•˜ëŠ” ì½”ë“œ ì…ë‹ˆë‹¤.
ë§ˆì§€ë§‰ color ìƒìˆ˜ì—ëŠ” name, valueë¥¼ ê°€ì§€ëŠ” ì»¬ëŸ¬ ê°ì²´ê°€ ëœë¤ìœ¼ë¡œ ì €ì¥ ë˜ê² ì§€ìš”.

```js
return msg => {
  const logString = `${color.value}[${tag}]${resetColor} ${msg}`
  console.log(logString)
  return logString
}
```

ë°˜í™˜ëœ í•¨ìˆ˜ì—ì„œ ì´ ëœë¤ ìƒ‰ìƒ ê°ì²´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
logStringì„ ë§Œë“¤ë•Œ íƒœê·¸ ë¬¸ìì—´ë§Œ ìƒ‰ìƒì„ ì§€ì •í–ˆìŠµë‹ˆë‹¤.

## Debug í™œìš©

ìš°ë¦¬ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì— ì´ debug ëª¨ë“ˆì„ ì´ìš©í•´ì„œ ë¡œê·¸ë¥¼ ë‚¨ê²¨ ë´…ì‹œë‹¤.

```js
// app.js
const debug = require("../utils/debug")("app")
// ...

debug("app is initiated")
```

```js
// bin.js
const debug = require('./utils/debug')('bin')
// ...

app.listen(port, hostname, () => {
  debug(`Server running at http://${hostname}:${port}/`);
```

```js
// src/Application.js
const debug = require("../utils/debug")("Application")
// ...

const listen = (port = 3000, hostname = "127.0.0.1", fn) => {
  _server.listen(port, hostname, fn)
  debug("server is listening")
}
```

ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì˜ˆìœ ëª¨ì–‘ì˜ ë¡œê·¸ê°€ ìƒ‰ìƒ ë³„ë¡œ ë‚˜ì˜¤ëŠ” ê±¸ í™•ì¸í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
$ npm start
```

![](/assets/imgs/2018/12/05/debug.png)

Debug ëª¨ë“ˆì€ ì•„ë˜ ì¨ë“œ íŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶€ë¶„ì…ë‹ˆë‹¤.

![](/assets/imgs/2018/12/05/struct.png)

## ì •ë¦¬

- ì»¤ìŠ¤í…€ ëª¨ë“ˆì¸ debugë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.
- íƒœê·¸ì™€ ìƒ‰ìƒìœ¼ë¡œ ë¡œê¹… ê¸°ëŠ¥ì„ ê°œì„ í•˜ì˜€ìŠµë‹ˆë‹¤.

[ëª©ì°¨ ë°”ë¡œê°€ê¸°](/series/2018/12/01/node-web-0_index.html)
