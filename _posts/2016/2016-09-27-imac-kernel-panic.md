---
title: '아이맥, 커널 패닉에 빠지다'
layout: post
category: dev
tags:
  osx
summary: 시에라 업데이트 후 커널패닉으로 부팅할수 없는 아이맥을 퓨전드라이브 재설정으로 복구했다.
permalink: /2016/09/27/imac-kernel-panic.html
---

아이맥이 커널 패닉 상태에 빠졌다. 검은 화면에서 벗어나지 못하고 16진수로 표현한 메모리 주소만을 뿜어 내고 있다.

![](/assets/imgs/2016/imac-kernel-panic-1.png)

아이맥에 시에라(Sierra)를 업그레드한 한뒤 새로움을 대하는 즐거움에 흠뻑 빠져있었다. 이틀뒤 유투브 영상을 전체 화면 모드로 즐기고 있는데 갑자기 검은색이 화면을 뒤덮었다. 모니터 전원이 나간것은 아니다. 자세히 보면 여전히 어두운 빛을 담고 있기 때문이다. 그러나 아무것도 동작하지 않는다.

찝찝하지만 전원버튼을 꾹 누르고 다시 켰다. 이후로는 커널 패닉에서 빠져 나올 기미가 없다.

커널 패닉이라니! 예전 학창시절에 리눅스로 삽질하고 헤멜때 종종 격는 커널패닉을 여기서 마주쳤다. 아...... 어떻하지? 젠장...... 내일 강의를 위한 준비자료를 여기에 작업해 놨는데...... 왜 하필 이럴때 ......


## 시도1. 시에라 재설치

시에라를 다시 설치하기로 했다. 우선 키보드에서 Cmd + r 을 꾹 누른채로 컴퓨터를 켰다. 1분정도 시간이 흐른뒤 복구 모드로 진입했다. 두번째에 시에라 다시 설치하기 메뉴가 보인다.

![](/assets/imgs/2016/imac-kernel-panic-2.png)

다시 설치를 진행을 클릭했다. 연결된 와이파이를 통해 시에라 설치파일을 다운로드 받기 시작했다. 수 분이 흐른뒤 다시 부팅되고 설치를 시도한다. 그러나 뭔가 진행되지 않은 것이 실패인듯 보였다.

## 시도2. 앨캐피탄 재설치

너무 성급하게 시에라를 설치해서 그런건가? 왜냐하면 그제 시에라가 나왔고 아직 다수의 사용자에게 검증되지 않은 상황에서 내가 불운아 중 한 명이 아닌가 싶었다. 그래서 이전 버전인 앨캐피탄 설치를 시도했다. 일반 복구 모드가 아니라 네트웍 복구 모드를 사용하면 아이맥이 출시될 때 설치된 운영체제 버전이 설치된다.

Cmd + Option + r 키를 누른상태로 컴퓨터를 부팅하면 네트웍 복구 모드로 진입한다. 이것은 일반 복구 모드에 비해 세 배정도 시간이 더 걸린 것 같다. 이번엔 두번째 메뉴에 엘캐피탄 설치 메뉴가 나온다.

![](/assets/imgs/2016/imac-kernel-panic-3.png)

클릭하고 진행하면 인터넷에서 엘캐피탄 설치파일을 다운로드한 뒤 아이맥이 재부팅된다. 하지만 동일한 에러 메세지를 뿜으면서 더 이상 진행되지 않는다.

![](/assets/imgs/2016/imac-kernel-panic-4.png)


## 시도3. Usb 클린 설치

폐인처럼 머리는 떡지고 헐렁한 추리닝으로 문구점에 갔다. 생각했던것 보다 usb 메모리 스틱 가격이 비싸지 않았다. 그럴바에얀 32기가나 64기가를 살까도 생각했다. 하지만 usb 사용할 일도 없고, 이번 설치때만 사용할 거니깐 16기가면 충분하다. 샌디스크 usb를 만원에 사서 돌아왔다.

![](/assets/imgs/2016/imac-kernel-panic-5.png)

처음으로 클린 설치를 시도해 봤다. [이 글](http://macnews.tistory.com/4937)을 참고하여 시에라 설치 파일을 다운받고 이것을 usb로 구워주는 DiskMaker X를 설치했다. 쉽게 설치 usb를 만들 수 있었다. 이것으로 부팅할 수 있다.

usb를 꼽은채 옵션(Option)키를 누른상태로 아이맥을 재부팅 했다. 디스크와 usb중 하나를 선택하는 화면이 나오자 usb를 선택했다. 곧장 usb로 부팅이 진행되었다. 복구 화면이 떴다. 곧장 시에라를 설치를 진행했다. 비교적 빠르게 진행되는 듯했다. 하지만 이것도 동일한 결과로 설치실패.

## 시도4. 디스크 유틸리티

그렇다면 이것은 운영체제 설치 프로그램의 문제는 아니다. 하드웨어적인 문제인것 같다는 생각이 들었다. 운영체제를 설치한다는 것은 프로그램을 하드디스크에 기록한다는 것인데...... 혹시 디스크 문제는 아닐까? 왜냐하면 SSD를 사용했던 맥북과는 달리 아이맥에서는 SSD와 HDD가 구성된 퓨전드라이브를 사용하기 때문이다.

다시 복구 모드(cmd + r)로 진입하여 디스크 유틸리티를 실행했다. 좌측의 퓨전드라이브를 선택한 뒤 검사/복구 버튼을 클릭하여 디스크 진단을 시도해봤다.

![](/assets/imgs/2016/imac-kernel-panic-6.png)

곧장 에러 메세지가 나왔다. 흔히 얘기하는 불량 섹터(?)가 생긴 것은 아닐까? 기계식 모터와 그 위에 핀으로 돌아가는 디스크에서는 왕왕 발생하는 일이다. 하...... 그럼 어떻게 한담?


## 시도5. 퓨전드라이브 재설정

[이 글](http://www.macworld.com/article/2014011/storage-drives/how-to-make-your-own-fusion-drive.html)은 SSD와 HDD를 직접 구매해서 퓨전드라이브를 만드는 방법에 대해 설명한다. 숨어있는 고수는 많다. 그렇다면 이것을 재설정 할 수 있는 방법도 있지 않을까?

[How_to_erase_and_create_a_Fusion_Drive](http://www.wurst-wasser.net/wiki/index.php/How_to_erase_and_create_a_Fusion_Drive) 그럼 그렇지! 누군가 위키에 잘 정리해 놓았다.

복구 모드(cmd + r)로 진입하여 터미널을 열었다. 먼저 디스크 목록을 찾는다.

```
diskutil coreStorage list
```

코어 스토리지가 뭔지는 잘 모르겠으나 그 목록을 조회하는 기능인것 같다. 16진수값으로 된 문자열이다. 이것을 이용해 기존 코어 스토리지의 볼륨 그룹을 삭제한다.

```
diskutil coreStorage delete {Logical Volum Group Name}
```

터미널을 종료하고 디스크 유틸리티를 열어보았다. 기존에 있던 퓨전드라이브가 없어졌다. 대신에 SSD와 HDD 인듯한 드라이브가 각 각 하나씩 생겼다. 퓨젼 드라이브로 묶여 있던 장치가 분리된 것이다. 아마도 coreStorage란 것이 볼륨을 의미하고 방금 삭제한 것이 퓨전드라이브에 해당하는 볼륨 그룹인것 같다. SDD와 HDD를 개별 볼륨으로 인식하고 이것을 그룹으로 묶어서 퓨젼드라이브 볼륨이 되는 것이라 생각했다.

다시 터미널을 열었다. 이번에 퓨젼드라이브 볼륨 그룹을 다시 생성하는 과정이다.

우선 내 장치 목록을 확인한다.

```
diskutil list
```

내 경우 `/dev/disk0`과 `/dev/disk1`이 HDD와 SDD 장치명이다. 출력되는 정보를 대충 보면서 식별할 수 있었다. 그리고 이 둘을 합쳐서 하나의 볼륨 그룹을 만든다.

```
diskutil coreStorage create myLogicalVolGroup /dev/disk0 /dev/disk1
```

볼륨 그룹을 생성하고 나면 "Core Storage LVG UUID"라는 볼륨 그룹 식별자를 얻을 수 있다. 이것도 16진수값으로 이뤄진 문자열이다. 이것을 이용해 마지막으로 볼륨을 생성한다.

```
diskutil coreStorage createVolume UUID jhfs+ “Macintosh HD” 100%
```

"UUID" 이 부분에 볼륨 그룹의 식별자를 입력한다. 그리고 jhfs+는 파티션 포맷 종류 중하나이다. 그리고 "Macintosh HD"는 볼륨이다. 마지막은 100%는 디스크의 모든 부분을 사용한다는 의미다.

명령어가 모두 실행되고 난뒤 터미널을 종료한다. 그리고 다시 디스크 유틸리티를 열어서 확인해보니 퓨젼 드라이브가 생성되었다! 하......

모든 것을 체크해 봤다. 디스크 검사/복구 버튼을 눌러서 정상을 확인했다. 파티션을 지우고 다시 만들어 보기도 했다. 디스크 볼륨이 제대로 만들어졌다. 만들어 놨던 시에라 설치 USB로 부팅하여 시에라 클린설치를 완료했다.

![](/assets/imgs/2016/imac-kernel-panic-7.png)
